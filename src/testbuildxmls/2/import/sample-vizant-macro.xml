<?xml version="1.0" encoding="UTF-8"?>
<project name="vizant-macro-import">
    <macrodef name="vizdot">
        <attribute name="antfile"/>
        <element name="viz-elements" optional="yes"/>
        <sequential>
            <ant target="just-for-fun" antfile="sample-macro-ant.xml"/>
            <property name="viz.to" value="" />
            <property name="viz.from" value="" />
            <property name="viz.antfileMap" value="" />
            <property name="viz.target.antfile" value="@{antfile}" />
            <property name="viz.output.dir" value="." />
            <property name="viz.output.format" value="png" />
            <property name="viz.nocluster" value="false" />
            <property name="viz.uniqueref" value="false" />
            <property name="viz.ignoreant" value="false" />
            <property name="viz.ignoreimport" value="false" />
            <property name="viz.ignoreantcall" value="false" />
            <property name="viz.ignoredepends" value="false" />
            <property name="viz.dotexec" value="dot" />

            <basename property="viz.base.jar" file="${vizant.jar}" />
            <basename property="viz.jar.name" file="${viz.base.jar}" suffix=".jar" />
            <basename property="viz.base.filename" file="${viz.antfile}" suffix=".xml" />
    
            <property name="viz.output.file"
                      value="${viz.output.dir}/${viz.dts}-${viz.base.filename}-${viz.jar.name}-${viz.from}-${viz.to}" />
        

            <echo message="vizant on ${viz.target.antfile}"/>

            <vizant to="${viz.to}"
                from="${viz.from}"
                antfile="${viz.target.antfile}"
                antfileMap="${viz.antfileMap}"
                nocluster="${viz.nocluster}"
                uniqueref="${viz.uniqueref}"
                ignoreant="${viz.ignoreant}"
                ignoreimport="${viz.ignoreimport}"
                ignoreantcall="${viz.ignoreantcall}"
                ignoredepends="${viz.ignoredepends}"
                outfile="${viz.output.file}.dot">
                
                <viz-elements/>                
            </vizant>

            <echo message="Saving using ${viz.output.file} see vizant.xml source for -D overrides"/>
                
            <exec executable="${viz.dotexec}">
                <arg line="-T${viz.output.format} ${viz.output.file}.dot -o ${viz.output.file}.${viz.output.format}"/>
            </exec>

        </sequential>
    </macrodef>
</project>
